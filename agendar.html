<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Précario - Barbearia João</title>

  <!-- AOS -->
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <!-- Firebase Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <link rel="stylesheet" href="style.css" />
  <style>
    .login-container {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      border-radius: 8px;
      color: #ff1f0f;
    }

    .login-btn {
      background-color: #e6b800;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
    }

    .login-btn:hover {
      background-color: #c9a100;
      color: white;
    }

    .login-btn img {
      width: 20px;
      height: 20px;
      margin-right: 10px;
      background: white;
      padding: 5px;
      border-radius: 3px;
    }

    .logged-in-info {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    .logged-in-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .logout-btn {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <header class="simple-header">
    <img src="images/logo.png" alt="Logo da Barbearia" class="logo-header" />
  </header>

  <section id="prices" class="section-dark">
    <a href="index.html" class="btn-back">Voltar</a>
    <h2 data-aos="fade-up">Précario</h2>
    <div class="services">
      <div class="service-card" data-aos="fade-up">
        <h3>Corte cabelo degrade</h3>
        <p>15€</p>
        <p>Duração: 40min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="100">
        <h3>Degrade + Barba</h3>
        <p>19€</p>
        <p>Duração: 60min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte de Criança</h3>
        <p>12€</p>
        <p>Duração: 30min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte + Barba</h3>
        <p>17€</p>
        <p>Duração: 40min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte + Navalha</h3>
        <p>10€</p>
        <p>Duração: 20min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte de 1 pente</h3>
        <p>8€</p>
        <p>Duração: 15min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte + Lavar</h3>
        <p>15€</p>
        <p>Duração: 40min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Barba</h3>
        <p>7€</p>
        <p>Duração: 25min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Barba terapia</h3>
        <p>10€</p>
        <p>Duração: 35min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Lavar e pentear</h3>
        <p>8€</p>
        <p>Duração: 15min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Gel e outros</h3>
        <p>4€</p>
        <p>Duração: 15min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Outros detalhes</h3>
        <p>3€</p>
        <p>Duração: 15min</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Corte + madeixas ou platinado</h3>
        <p>35€ ou 50€</p>
        <p>sobre consulta</p>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Acréscimo após as 20h</h3>
      </div>
      <div class="service-card" data-aos="fade-up" data-aos-delay="200">
        <h3>Acréscimo feriados</h3>
        <p>5€</p>
      </div>
    </div>
  </section>

  <section id="booking">
    <div class="booking-container" data-aos="fade-up">
      <h2>Agendamento</h2>
      <form id="bookingForm">
        <input type="text" id="name" name="name" placeholder="Seu nome completo" required />
        <input type="tel" id="phone" name="phone" placeholder="WhatsApp (ex: +351 9XX XXX XXX)" required />
        <input type="email" id="email" name="email" placeholder="Seu e-mail" required />

        <select id="service" name="service" required>
          <option value="">Selecione o serviço</option>
          <option value="Corte cabelo degrade">Corte cabelo degrade - 15€</option>
          <option value="Degrade + Barba">Degrade + Barba - 19€</option>
          <option value="Corte de Criança">Corte de Criança - 12€</option>
          <option value="Corte + Barba">Corte + Barba - 17€</option>
          <option value="Corte + Navalha">Corte + Navalha - 10€</option>
          <option value="Corte de 1 pente">Corte de 1 pente - 8€</option>
          <option value="Corte + Lavar">Corte + Lavar - 15€</option>
          <option value="Barba">Barba - 7€</option>
          <option value="Barba terapia">Barba terapia - 10€</option>
          <option value="Lavar e pentear">Lavar e pentear - 8€</option>
          <option value="Gel e outros">Gel e outros - 4€</option>
          <option value="Outros detalhes">Outros detalhes - 3€</option>
          <option value="Corte + madeixas ou platinado">Corte + madeixas ou platinado (sobre consulta)</option>
        </select>

        <!-- BARBEIROS ATUALIZADO AQUI -->
        <select id="barber" name="barber" required>
          <option value="">Selecione o barbeiro</option>
          <option value="João Dias">João Dias</option>
          <option value="Rodrigo Lobo">Rodrigo Lobo</option>
          <option value="aleatorio">Aleatorio</option>
        </select>

        <div class="custom-date-wrapper" onclick="document.getElementById('dateSelect').showPicker()">
          <input type="date" id="dateSelect" name="dateSelect" required />
        </div>

        <select id="timeSelect" name="timeSelect" required>
          <option value="">Selecione um horário</option>
        </select>

        <select id="paymentMethod" name="paymentMethod" required onchange="toggleMbwayDetails()">
          <option value="">Método de Pagamento</option>
          <option value="barbearia">Pagar na Barbearia</option>
          <option value="mbway">Pagar via MB WAY</option>
        </select>

        <div id="mbwayDetails" style="display: none;">
          <p><strong>Número MB WAY:</strong> 912 100 746</p>
          <p><strong>IBAN:</strong> PT50 0193 0000 10510490351 50</p>
          <label for="mbwayProof">Envie o comprovativo (Apenas Imagem):</label>
          <input type="file" id="mbwayProof" accept="image/*,.pdf" />
        </div>

        <button type="submit">Confirmar Agendamento</button>
      </form>
    </div>
  </section>

  <!-- Scripts -->
  <script type="module" src="agendar.js"></script>
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <!-- Firebase Config -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCs6C-IroGVlIqCUa6XPvYliTmlVzaPgyU",
    authDomain: "bairros-c5d5b.firebaseapp.com",
    databaseURL: "https://bairros-c5d5b-default-rtdb.firebaseio.com",
    projectId: "bairros-c5d5b",
    storageBucket: "bairros-c5d5b.appspot.com",
    messagingSenderId: "765859348286",
    appId: "1:765859348286:web:bdc83cc3277ebc9f95766f",
    measurementId: "G-6C2NTSSVQ0"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
</script>

<!-- Login e Lógica -->
<!-- Login e Lógica -->
<script>
  const loginContainer = document.createElement("div");
  loginContainer.className = "login-container";
  loginContainer.innerHTML = `
    <div id="user-info" class="logged-in-info hidden">
      <img id="user-pic" alt="Foto do usuário" />
      <span id="user-name"></span>
      <button class="logout-btn" id="logoutBtn">Sair</button>
    </div>
    <button class="login-btn" id="loginBtn">
      <img src="https://img.icons8.com/color/48/google-logo.png" alt="Google logo" /> Entrar com Google
    </button>
    <p id="login-msg">⚠️ Você precisa estar logado para agendar</p>
  `;

  const bookingSection = document.getElementById("booking");
  const title = bookingSection.querySelector("h2");
  title.insertAdjacentElement('afterend', loginContainer);

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const loginMsg = document.getElementById("login-msg");
  const userInfo = document.getElementById("user-info");
  const bookingForm = document.getElementById("bookingForm");
  const userName = document.getElementById("user-name");
  const userPic = document.getElementById("user-pic");
  // Variável para guardar o serviço clicado enquanto não estiver logado
let selectedServiceBeforeLogin = null;

// Função para preencher o serviço no formulário
function fillService(serviceName) {
  const serviceSelect = document.getElementById("service");
  for (let option of serviceSelect.options) {
    if (option.value === serviceName) {
      serviceSelect.value = option.value;
      break;
    }
  }
}

// Adicionar evento de clique em todos os cards de serviço
document.querySelectorAll(".service-card").forEach(card => {
  card.addEventListener("click", () => {
    const serviceName = card.querySelector("h3").innerText.trim();

    if (!auth.currentUser) {
      // Usuário NÃO está logado
      selectedServiceBeforeLogin = serviceName;

      // Mostrar a seção de login e formulário
      loginContainer.classList.remove("hidden");
      
      // Scroll para a div de login/booking
      loginContainer.scrollIntoView({ behavior: "smooth" });
    } else {
      // Usuário está logado, preencher o serviço diretamente
      fillService(serviceName);

      // Scroll para o formulário de agendamento
      bookingSection.scrollIntoView({ behavior: "smooth" });
    }
  });
});

// Monitorar mudanças de estado do usuário logado
auth.onAuthStateChanged(user => {
  if (user) {
    // Mostrar info do usuário
    userInfo.classList.remove("hidden");
    loginBtn.classList.add("hidden");
    loginMsg.classList.add("hidden");
    userName.textContent = user.displayName || "Usuário";
    userPic.src = user.photoURL || "";

    // Se tinha serviço selecionado antes do login, preencher o formulário e scroll para agendamento
    if (selectedServiceBeforeLogin) {
      fillService(selectedServiceBeforeLogin);
      selectedServiceBeforeLogin = null;
      bookingSection.scrollIntoView({ behavior: "smooth" });
    }
  } else {
    // Não logado, mostrar botão de login
    userInfo.classList.add("hidden");
    loginBtn.classList.remove("hidden");
    loginMsg.classList.remove("hidden");
  }
});


  // Função para login via Google
  function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .catch(error => {
        alert("Erro ao fazer login: " + error.message);
        console.error(error);
      });
  }

  // Função para logout
  function logout() {
    auth.signOut()
      .catch(error => {
        alert("Erro ao sair: " + error.message);
        console.error(error);
      });
  }

  // Eventos de clique
  loginBtn.addEventListener("click", login);
  logoutBtn.addEventListener("click", logout);

  // Monitorar estado de autenticação
  auth.onAuthStateChanged(user => {
    if (user) {
      userName.textContent = user.displayName;
      userPic.src = user.photoURL;

      loginBtn.classList.add("hidden");
      loginMsg.classList.add("hidden");
      userInfo.classList.remove("hidden");
      bookingForm.classList.remove("hidden");
    } else {
      loginBtn.classList.remove("hidden");
      loginMsg.classList.remove("hidden");
      userInfo.classList.add("hidden");
      bookingForm.classList.add("hidden");
    }
  });
</script>


<!-- Card Click Script -->
<script>
  const serviceCards = document.querySelectorAll('.service-card');
  const serviceSelect = document.getElementById('service');

  serviceCards.forEach(card => {
    card.style.cursor = 'pointer';
    card.addEventListener('click', () => {
      const serviceName = card.querySelector('h3').textContent.trim();
      const option = Array.from(serviceSelect.options).find(opt => opt.text.includes(serviceName));
      if (option) {
        serviceSelect.value = option.value;
        serviceSelect.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script>
  AOS.init();
</script>

</body>

</html>